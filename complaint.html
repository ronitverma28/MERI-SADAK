<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Report Complaint - MERI SADAK</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="index.html">
          <i class="fas fa-road text-primary me-2"></i>
          MERI SADAK
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About Us</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="complaint.html">Complaint</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="records.html">Records</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact Us</a>
            </li>
          </ul>

          <div class="d-flex login-signup-buttons">
            <a href="login.html" class="btn btn-outline-primary me-2">Login</a>
            <a href="signup.html" class="btn btn-primary">Sign Up</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Page Header -->
    <section
      class="py-4"
      style="
        margin-top: 76px;
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          #1a5f8a 100%
        );
        color: white;
      "
    >
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto text-center">
            <h1 class="display-5 mb-3">Report a Road Issue</h1>
            <p class="lead">
              Help us maintain better roads by reporting issues in your area
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Complaint Form -->
    <section class="py-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="card shadow-lg">
              <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                  <i class="fas fa-exclamation-triangle me-2"></i>Complaint
                  Details
                </h4>
              </div>
              <div class="card-body p-4">
                <form id="complaintForm">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="title" class="form-label"
                        >Issue Title *</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="title"
                        name="title"
                        required
                        placeholder="Brief description of the issue"
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="type" class="form-label">Issue Type *</label>
                      <select
                        class="form-select"
                        id="type"
                        name="type"
                        required
                      >
                        <option value="">Select issue type</option>
                        <option value="pothole">Pothole</option>
                        <option value="damaged-sign">Damaged Road Sign</option>
                        <option value="drainage">Drainage Problem</option>
                        <option value="streetlight">Street Light Issue</option>
                        <option value="road-surface">
                          Road Surface Damage
                        </option>
                        <option value="traffic-signal">
                          Traffic Signal Problem
                        </option>
                        <option value="sidewalk">Sidewalk Issue</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="priority" class="form-label"
                        >Priority Level *</label
                      >
                      <select
                        class="form-select"
                        id="priority"
                        name="priority"
                        required
                      >
                        <option value="">Select priority</option>
                        <option value="low">Low - Minor inconvenience</option>
                        <option value="medium">
                          Medium - Moderate safety concern
                        </option>
                        <option value="high">
                          High - Significant safety risk
                        </option>
                        <option value="urgent">
                          Urgent - Immediate danger
                        </option>
                      </select>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="state-select" class="form-label"
                        >State *</label
                      >
                      <select
                        class="form-select mb-2"
                        id="state-select"
                        name="state"
                        required
                      >
                        <option value="">Select state</option>
                      </select>

                      <label for="city-select" class="form-label">City *</label>
                      <select
                        class="form-select"
                        id="city-select"
                        name="city"
                        required
                      >
                        <option value="">Select city</option>
                      </select>
                    </div>
                  </div>

                  <div class="mb-3">
                    <label for="description" class="form-label"
                      >Detailed Description *</label
                    >
                    <textarea
                      class="form-control"
                      id="description"
                      name="description"
                      rows="4"
                      required
                      placeholder="Please provide detailed information about the issue, including when you first noticed it and any relevant details..."
                    ></textarea>
                  </div>

                  <!-- Image upload removed; use state and city selects above instead -->

                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="contactName" class="form-label"
                        >Your Name</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="contactName"
                        name="contactName"
                        placeholder="Name for follow-up"
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="contactEmail" class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control"
                        id="contactEmail"
                        name="contactEmail"
                        placeholder="Email for updates"
                      />
                    </div>
                  </div>

                  <div class="mb-4">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="anonymous"
                        name="anonymous"
                      />
                      <label class="form-check-label" for="anonymous">
                        Submit anonymously
                      </label>
                    </div>
                  </div>

                  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button
                      type="button"
                      class="btn btn-outline-secondary me-md-2"
                      onclick="resetForm()"
                    >
                      Reset Form
                    </button>
                    <button type="submit" class="btn btn-primary btn-lg">
                      <i class="fas fa-paper-plane me-2"></i>Submit Complaint
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Guidelines Section -->
    <section class="py-5 bg-light-custom">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <div class="card">
              <div class="card-header bg-accent text-dark">
                <h4 class="mb-0">
                  <i class="fas fa-info-circle me-2"></i>Reporting Guidelines
                </h4>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h6>
                      <i class="fas fa-check text-success me-2"></i>What to
                      Include:
                    </h6>
                    <ul class="list-unstyled">
                      <li>• Clear, detailed description</li>
                      <li>• Specific location details</li>
                      <li>• Photos if possible</li>
                      <li>• Approximate date noticed</li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <h6>
                      <i class="fas fa-times text-danger me-2"></i>What Not to
                      Include:
                    </h6>
                    <ul class="list-unstyled">
                      <li>• Personal complaints</li>
                      <li>• Non-road related issues</li>
                      <li>• Blurry or unclear photos</li>
                      <li>• Inappropriate content</li>
                    </ul>
                  </div>
                </div>
                <div class="alert alert-info mt-3">
                  <i class="fas fa-lightbulb me-2"></i>
                  <strong>Tip:</strong> The more specific and detailed your
                  report, the faster we can address the issue!
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 mb-4">
            <h5><i class="fas fa-road me-2"></i>MERI SADAK</h5>
            <p>
              Your trusted partner in road maintenance and infrastructure
              improvement. Together, we build better communities.
            </p>
            <div class="social-icons">
              <a href="#"><i class="fab fa-facebook"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-linkedin"></i></a>
            </div>
          </div>

          <div class="col-lg-2 col-md-6 mb-4">
            <h5>Quick Links</h5>
            <ul class="list-unstyled">
              <li><a href="index.html">Home</a></li>
              <li><a href="about.html">About Us</a></li>
              <li><a href="complaint.html">Report Issue</a></li>
              <li><a href="records.html">View Records</a></li>
              <li><a href="contact.html">Contact</a></li>
            </ul>
          </div>

          <div class="col-lg-3 col-md-6 mb-4">
            <h5>Support</h5>
            <ul class="list-unstyled">
              <li><a href="#">Help Center</a></li>
              <li><a href="#">Privacy Policy</a></li>
              <li><a href="#">Terms of Service</a></li>
              <li><a href="#">FAQ</a></li>
            </ul>
          </div>

          <div class="col-lg-3 mb-4">
            <h5>Contact Info</h5>
            <ul class="list-unstyled">
              <li><i class="fas fa-phone me-2"></i>+1 (555) 123-4567</li>
              <li><i class="fas fa-envelope me-2"></i>info@merisadak.com</li>
              <li>
                <i class="fas fa-map-marker-alt me-2"></i>123 Main St, City,
                State 12345
              </li>
            </ul>
          </div>
        </div>

        <hr class="my-4" />
        <div class="row align-items-center">
          <div class="col-md-6">
            <p class="mb-0">&copy; 2024 MERI SADAK. All rights reserved.</p>
          </div>
          <div class="col-md-6 text-md-end">
            <p class="mb-0">
              Made with <i class="fas fa-heart text-danger"></i> for better
              roads
            </p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="assets/js/main.js"></script>
    <script src="assets/js/auth.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const stateSelect = document.getElementById("state-select");
        const citySelect = document.getElementById("city-select");
        const dataUrl = "assets/data/stateDistricts.json";

        let stateData = null;

        // Start with city disabled until state chosen
        citySelect.innerHTML = '<option value="">Select city</option>';
        citySelect.disabled = true;

        function populateStates(data) {
          stateSelect.innerHTML = '<option value="">Select state</option>';
          for (const code in data) {
            if (Object.prototype.hasOwnProperty.call(data, code)) {
              const opt = document.createElement("option");
              opt.value = code;
              opt.textContent = data[code].name;
              stateSelect.appendChild(opt);
            }
          }
          stateSelect.disabled = false;
        }

        function populateCities(code) {
          citySelect.innerHTML = '<option value="">Select city</option>';
          citySelect.disabled = true;
          if (!code || !stateData || !stateData[code]) return;
          const cities = stateData[code].cities || [];
          cities.forEach(function (city) {
            const opt = document.createElement("option");
            opt.value = city.toLowerCase().replace(/\s+/g, "-");
            opt.textContent = city;
            citySelect.appendChild(opt);
          });
          citySelect.disabled = false;
        }

        // Show loading placeholder while fetching
        stateSelect.innerHTML = "<option>Loading states...</option>";
        stateSelect.disabled = true;

        fetch(dataUrl)
          .then(function (res) {
            return res.json();
          })
          .then(function (data) {
            stateData = data;
            populateStates(data);
            // Keep cities cleared until user selects
            populateCities(stateSelect.value);
          })
          .catch(function (err) {
            console.error("Could not load state/city data:", err);
            // Fallback: show a minimal manual option
            stateSelect.innerHTML =
              '<option value="">Select state</option><option value="other">Other</option>';
            stateSelect.disabled = false;
          });

        stateSelect.addEventListener("change", function () {
          populateCities(this.value);
        });
      });

      function resetForm() {
        document.getElementById("complaintForm").reset();
        var imgPrev = document.getElementById("imagePreview");
        if (imgPrev) imgPrev.style.display = "none";
        var stateSelect = document.getElementById("state-select");
        if (stateSelect) stateSelect.dispatchEvent(new Event("change"));
      }
    </script>
    <script>
      // Handle complaint form submission: validate and save to localStorage
      (function () {
        const form = document.getElementById("complaintForm");
        if (!form) return;

        form.addEventListener("submit", function (e) {
          e.preventDefault();

          // Use existing validateForm from main.js if available
          let valid = true;
          if (typeof validateForm === "function") {
            valid = validateForm(form);
          } else {
            // Basic validation
            const required = form.querySelectorAll("[required]");
            required.forEach(function (el) {
              if (!el.value) valid = false;
            });
          }

          if (!valid) {
            if (typeof showErrorMessage === "function")
              showErrorMessage(
                "Please fix validation errors before submitting."
              );
            return;
          }

          // Build complaint object
          const title = document.getElementById("title").value.trim();
          const type = document.getElementById("type").value;
          const priority = document.getElementById("priority").value;
          const state = document.getElementById("state-select").value;
          const city = document.getElementById("city-select").value;
          const description = document
            .getElementById("description")
            .value.trim();
          const contactName = document
            .getElementById("contactName")
            .value.trim();
          const contactEmail = document
            .getElementById("contactEmail")
            .value.trim();
          const anonymous = document.getElementById("anonymous").checked;

          const today = new Date().toISOString().split("T")[0];

          // Generate an ID using timestamp
          const id = "RS-" + Date.now();

          const complaint = {
            id: id,
            title: title,
            description: description,
            type: type || "other",
            status: "open",
            priority: priority || "low",
            date: today,
            state: state || "",
            district: city || "",
            location: "",
            reporterName: anonymous ? "" : contactName,
            reporterEmail: anonymous ? "" : contactEmail,
          };

          // Save to localStorage under key 'merisadak_records'
          try {
            const key = "merisadak_records";
            const existing = JSON.parse(localStorage.getItem(key) || "[]");
            existing.unshift(complaint); // add newest first
            localStorage.setItem(key, JSON.stringify(existing));

            if (typeof showSuccessMessage === "function")
              showSuccessMessage("Complaint submitted and saved locally.");
            // Optionally redirect to records page to view
            setTimeout(function () {
              window.location.href = "records.html";
            }, 700);
          } catch (err) {
            console.error("Failed to save complaint", err);
            if (typeof showErrorMessage === "function")
              showErrorMessage("Failed to save complaint locally.");
          }
        });
      })();
    </script>
  </body>
</html>
